//eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('4j([\'n\',\'1J\',\'1n/U/b\',\'1n/3a/1Y\',\'1n/3a/I\',\'1n/4i/R\',\'1n/2t/3d/2O\',\'1n/U/12\'],3(n,1J,b,1Y,I,R,2O,12){g 2={};2.2a=3(S){2.3b=S.3b;2.t=S.t;2.e=S.e;2.E=0;2.1f=[];2.w=1;2.2l=S.2l;2.1z=S.1z;2.26=S.26;2.1Z=S.1Z;2.1p=S.1p;2.19=S.19;2.2P=0;6(2.e=="e"){$(\'#m .m.F\').A(\'F\');$("#e-m").y("F");2.2N()}6(!2.1p){1k.m({5:$(\'#m\'),3c:{4f:3(){$(\'.G-c\').9();2.2p();2.22();2.1F();2.1D();$(".s-1y").9();$(".Y-G").p()},2A:3(){2.22();2.1F();2.1D();2.2k();$(".s-1y").9();$(".Y-G").p()},2w:3(){2.3A();2.1F();2.1D();$(".s-1y").9();$(".Y-G").p()},2x:3(){2.3E();2.1D();$(".s-1y").9();$(".Y-G").p()},4g:3(){2.2N()}}})}u{2.2m();1k.m({5:$(\'#4l\'),3c:{2A:3(){$(".q-m-1m .m-1m[h-m=\'2A\']").9().2y().p()},2w:3(){$(".q-m-1m .m-1m[h-m=\'2w\']").9().2y().p()},2x:3(){$(".q-m-1m .m-1m[h-m=\'2x\']").9().2y().p();6(!$(\'.1w-c\').B(\'1r\')){$(\'.1w-c\').B(\'1r\',1);2.1o()}}}})}$(\'.3d-2n\').7(3(){2.39()});2.39=3(N){2O.9({1Z:2.1Z})};2.2p();2.22();2.1F();$(\'.2L-2n\').7(3(){2.25(\'\')});$(\'#L-7\').17("7",3(){$("#L-b").9();$(".L-o").9()});$(\'.L-k\').17("7",3(){$("#L-b").p()});$(\'#L-3N\').17("7",3(){$("#L-b").p()});$(\'#38-b\').7(3(){2.C=X 13({o:$(\'#38-b-2\').8(),14:\'b-2\',15:3(){2.C.k()}});2.C.5.j(\'.Q-16\').7(3(){2.C.k()});2.C.9()});$(\'#b-34\').7(3(){2.1A=X 13({o:$(\'#b-34-2\').8(),14:\'b-2\',15:3(){2.1A.k()}});2.1A.5.j(\'.Q-16\').7(3(){2.1A.k()});2.1A.9()});$(\'#35-b\').7(3(){2.C=X 13({o:$(\'#35-b-2\').8(),14:\'b-2\',15:3(){2.C.k()}});2.C.5.j(\'.Q-16\').7(3(){2.C.k()});2.C.9()});$(\'#2t-b\').7(3(){2.C=X 13({o:$(\'#2t-b-2\').8(),14:\'b-2\',15:3(){2.C.k()}});1k.3Z.2a();2.C.5.j(\'.Q-16\').7(3(){2.C.k()});2.C.9()});$(".36-37 .49").7(3(){g 1c=$(z).h(\'1c\');6(1c==4){2.12(\'I\')}u{2.25(\'I\')}});$(".36-37 .4b").7(3(){g 1c=$(z).h(\'1c\');6(1c==4){2.12(\'1S\')}u{2.25(\'1S\')}});6($(\'#1M-5\').D>0||$(\'#3e-5\').D>0){$(\'.s-3f\').1T({3n:3(){1N.1O()},3o:3(){1N.1O()}})}u 6($(\'#1M-48\').D>0||$(\'#3e-5\').D>0){$(\'.s-3f\').1T({3n:3(){1N.1O()},3o:3(){1N.1O()}})}u 6($(\'.2e-5\').D>0){2.3M()}$(\'.1Y-1i\').7(3(){g W=$(z);6(W.B(\'2b\')==\'1\'){1a}W.B(\'2b\',1);g 1x=W.B(\'h-1x\')==\'1\';g l=W.j(\'.l\');l.y(\'l-32\').A(\'l-3q\');W.A(\'F\');1x=W.B(\'h-1x\')==\'1\'?0:1;1Y.46(2.t,1x,3(2j){W.4p(\'2b\').B("h-1x",2j?"1":0);6(2j){l.y(\'l-3q\').A(\'l-32\');W.y(\'F\')}})});6(n.4T()){$(\'#Q-3l\').7(3(){$(\'#2o\').4Q(4R)});$(\'#2o\').7(3(){$(\'#2o\').p()})}u{$(\'#Q-3l\').7(3(){6(n.4X()){1a}1k.L("请复制链接发送给好友")})}6(2.2l){n.1s(\'U/q/52\',{K:2.t},3(r){g f=r.f;$(".s-l-1e[h-1g=\'2G\']").j(\'.P\').8(f.P.2G);$(".s-l-1e[h-1g=\'3h\']").j(\'.P\').8(f.P.3h);$(".s-l-1e[h-1g=\'3g\']").j(\'.P\').8(f.P.3g);$(".s-l-1e[h-1g=\'3i\']").j(\'.P\').8(f.P.3i);$(".s-l-1e[h-1g=\'3k\']").j(\'.P\').8(f.P.3k);6(r.1I==1&&f.d.D>0){2.3H();6(!2.1p){$(\'#3r\').9();n.1J(\'#v-5\',\'53\',r.f);$(\'#v-5 .s-2v:3S-3Y\').7(3(){$("#3r").7()})}$(\'#v-5\').3s()};n.1K(\'#v-5 .2W.18 18\')})}6(!2.1p){$(\'.G-c\').2X({4P:3(){$(".Y-q").8("<i 24=\'l l-3X\'></i> <T>释放查看图文详情</T>")},3I:3(){$(".Y-q").8("<i 24=\'l l-3W\'></i> <T>上拉查看图文详情</T>");$(\'.G-c\').2X(\'3V\');2.2k();$(\'#m .m.F\').A(\'F\');$(\'#m .m:4B(1)\').y(\'F\')}})}6(4C(1h.O)!==\'4D\'){b.4A(1h.O)};n.1K(\'.U-2S .s-2S-1i 18\');$(".s-2v-4z").7(3(){2.1j=X 13({o:$(\'#2g-b-2\').8(),14:\'b-2\',15:3(){2.1j.k()}});2.1j.5.j(\'.Q-16\').7(3(){2.1j.k()});2.1j.9();g J=$("#J").1B();$(".2g-1i").4w(3(){6($(z).1B()==J){$(z).4x("4y","M")}});$(".2g-1i").17("7",3(){$.2I({2J:n.1C(\'U/q/4F\',{K:$(z).1B()}),30:M,2Y:3(h){h=1h.31.4L(h);6(h.1I>0){$("#J").1B(h.f.K);$("#4M").29(h.f.4N)}}})})});$(".e-d-m a").23("7").17("7",3(){g 2f=$(z);2.2P=2f.B("h-1c");$(".e-d-m a").A("F");2f.y("F");2.2i()});2.2H();$(\'.9-4J-Q\').7(3(){$(z).4G(\'.4H-5\').y(\'2z\')})};2.12=3(N){12.2z({t:2.t,w:2.w,3C:\';\',N:N,E:\'\',3y:M,3x:1d,1U:2.1U,1R:2.1R,3t:3(1f){2.1f=1f;6(N==\'1S\'){12.k();$.2r.2q(n.1C(\'1G/1E\',{K:2.t,4I:1,1f:1h.31.4V(2.1f)}),1d)}u 6(N==\'I\'){I.4K(2.t,2.1f,3(r){$(\'.I-1i\').j(\'.2u\').8(r.O).A(\'2K\').y(\'H\');1h.O=r.O});12.k()}u{12.k()}}})};2.1j=3(){2.1j=X 13({o:$(\'#2L-b-2\').8(),14:\'b-2\',15:3(){2.51.k()}})};2.2m=3(){6($(\'.q-c\').j(\'.o-c\').8()!=\'\'){1a}1k.2T.9(\'50\');$.2I({2J:n.1C(\'U/q/4Z\',{K:2.t}),30:M,2Y:3(8){1k.2T.p();g 2U=$(\'.q-c\').2M(\'2R\');$(\'.q-c\').j(\'.o-c\').2M(\'2R\',2U).8(8);41(3(){$(\'.q-c\').3s();$(\'.q-c\').j(\'.o-c\').2M(\'2R\',\'4o\');n.1K(\'.o-c 18\');g $8=$(8).j(\'18\');6($8.D>0){4n(g i=0,2V=$8.D;i<2V;i++){$8[i].4t=3(){g $z=$(z);g 1v=$z.B(\'h-3R\');6(!$z.B(\'3T-21\')&&(1v.2B(\'4s://\')>-1||1v.2B(\'4m://\')>-1)){g 21=1v.2B(2.1z)==-1?1v.3m(2.26,2.1z):1v.3m(2.1z,2.26);$z.B(\'h-3R\',21);$z.B(\'3T-21\',M)}}}}},2D);6(!2.1p){$(\'.q-c\').3U({4d:3(){$(".Y-G").8("<i 24=\'l l-3W\'></i> <T>释放返回商品详情</T>")},43:3(){$(".Y-G").8("<i 24=\'l l-3X\'></i> <T>下拉返回商品详情</T>");$(\'.G-c\').9();$(\'.q-c\').A(\'H\').3U(\'3V\');$(\'#m .m.F\').A(\'F\');$(\'#m .m:3S-3Y\').y(\'F\')}})}}})};2.2k=3(){$(\'.G-c\').p();2.2m();$(\'.q-c\').1W(3z).y(\'H\').1V(3(){$(\'.q-c\').1W(\'\')})};2.2p=3(){$(\'.G-c\').9();$(\'.q-c\').1W(3z).A(\'H\').1V(3(){$(\'.q-c\').1W(\'\')})};2.3A=3(){$(\'.3B-c\').9().y(\'H\')};2.22=3(){$(\'.3B-c\').A(\'H\')};2.25=3(N){b.2z({t:2.t,w:2.w,3C:\';\',N:N,E:2.E,3y:M,3x:1d,1U:2.1U,1R:2.1R,19:2.19,3t:3(w,E,3Q){2.w=w;2.E=E;$(\'.2L-2n\').8("已选: 数量x"+w+" "+3Q);6(N==\'1S\'){g J=$("#J").1B();6($("#J")&&J==\'\'){1k.L("请选择赠品！");$(".b-2").4Y()}u{6($(\'.R-5\').D>0){g V=R.3v(\'.R-5\');6(!V){1a}u{n.1s(\'1G/1E/R\',{K:2.t,V:V},3(r){$.2r.2q(n.1C(\'1G/1E\',{K:2.t,E:2.E,w:2.w,4U:r.f.4W,J:J,19:2.19}),M)},M,M);b.k()}}u{b.k();$.2r.2q(n.1C(\'1G/1E\',{K:2.t,E:2.E,w:2.w,J:J,19:2.19}),1d)}}}u 6(N==\'I\'){6($(\'.R-5\').D>0){g V=R.3v(\'.R-5\');6(!V){1a}u{n.1s(\'1G/1E/R\',{K:2.t,V:V},3(r){I.3D(2.t,2.E,2.w,V,3(r){$(\'.I-1i\').j(\'.2u\').8(r.O).A(\'2K\').y(\'H\');1h.O=r.O})},M,M);b.k()}}u{I.3D(2.t,2.E,2.w,1d,3(r){$(\'.I-1i\').j(\'.2u\').8(r.O).A(\'2K\').y(\'H\');1h.O=r.O});b.k()}}u{b.k()}}})};2.3E=3(){$(\'.1w-c\').9().y(\'H\').1V(3(){6(!$(\'.1w-c\').B(\'1r\')){$(\'.1w-c\').B(\'1r\',1);2.1o()}})};2.2N=3(){$(\'.e-c\').9().y(\'H\').1V(3(){6(!$(\'.e-c\').B(\'1r\')){$(\'.e-c\').B(\'1r\',1);2.2i()}});$(".e-U-3J").9();$(".s-1y").p();$(".Y-G").p()};2.1D=3(){$(\'.e-c\').A(\'H\');$(".e-U-3J").p()};2.1F=3(){$(\'.1w-c\').A(\'H\')};2.3H=3(){2.1l=1;2.2E=\'\';2.27=1;$(\'.s-o\').11({3I:3(){2.1o()}});6(2.1l==1){2.1o()}};2.1o=3(){$(\'#v-d-5 .o-1t\').p();$(\'#v-d-5 .11-2Z\').9();n.1s(\'U/q/4e\',{K:2.t,3u:2.1l,1g:2.2E,4h:2.27},3(r){g f=r.f;6(f.w<=0){$(\'#v-d-5 .5\').8(\'\').p();$(\'#v-d-5 .o-1t\').9();$(\'#v-d-5\').11(\'28\')}u{$(\'#v-d-5 .5\').9();$(\'#v-d-5 .o-1t\').p();$(\'#v-d-5\').11(\'2a\');6(f.d.D<=0||f.d.D<f.3j){$(\'#v-d-5\').11(\'28\')}}2.27=0;2.1l++;n.1J(\'#v-d-5 .5\',\'4k\',f,2.1l>1);$(\'#v-d-5 .s-l-3K .s-l-1e\').4u(\'7\').7(3(){$(\'#v-d-5 .s-l-3K .s-l-1e T.29-16\').A(\'29-16\');$(z).j(\'T\').y(\'29-16\');2.1l=1;2.27=1;2.2E=$(z).h(\'1g\');$(\'#v-d-5 .5\').8(\'\');2.1o()});n.1K(\'#v-2G .2W.18 18\')},1d)};2.2i=3(){$(\'#e-d-5 .o-1t\').p();$(\'#e-d-5 .11-2Z\').9();n.1s(\'U/q/45\',{K:2.t,3u:2.2c,1c:2.2P},3(r){g f=r.f;6(f.w<=0){$(\'#e-d-5 .5\').8(\'\').p();$(\'#e-d-5 .o-1t\').9();$(\'#e-d-5\').11(\'28\')}u{$(\'#e-d-5 .5\').9();$(\'#e-d-5 .o-1t\').p();$(\'#e-d-5\').11(\'2a\');6(f.3p.D<=0||f.3p.D<f.3j){$(\'#e-d-5\').11(\'28\')}}2.2c++;n.1J(\'#e-d-5 .4E\',\'4O\',f,2.2c>1);n.1K(\'.j-d-o-4S a 18\');2.2H();$(".e-3L").23("7").17("7",3(){2.1H=X 13({o:$(\'#b-3L-2\').8(),14:\'b-2\',15:3(){2.1H.k()}});2.1H.5.j(\'.Q-3F\').7(3(){2.1H.k()});2.1H.9()});$(\'#e-3N\').23("7").17("7",3(){$("#e-b").p()})},1d)};2.2H=3(){$(\'.e-3G\').7(3(){2.1u=X 13({o:$(\'#b-3G-2\').8(),14:\'b-2\',15:3(){2.1u.k()}});2.1u.5.j(\'.Q-3F\').7(3(){2.1u.k()});2.1u.9();$(".e-2v-4q").23("7").17("7",3(){2.1u.k();$("#L-b").9();$(".L-o").9()})})};2.3P=3(3O){g 1b=1Q(3O);g Z=0;g 1P=0;6(1b>1q){Z=1Q(1b/1q);1b=1Q(1b%1q);6(Z>1q){1P=1Q(Z/1q);Z=1Q(Z%1q)}}1a{\'2Q\':1P<10?\'0\'+1P:1P,\'2C\':Z<10?\'0\'+Z:Z,\'2s\':1b<10?\'0\'+1b:1b}};2.3M=3(){g 5=$(\'.2e-5\'),2h=5.h(\'2h\'),2d=5.h(\'2d\'),1I=5.h(\'1I\')||0;$.2I({2J:\'../40/42/4c.1s\',4a:3(x){47=+X 3w(x.44("3w"))/2D;6(1I==0){2.1L=2d}u{2.1L=2h}4v(2.1T);2.2F();2.1T=2.33()}})};2.2F=3(){2.1L-=1;g 1X=2.3P(2.1L);g 20=$(\'.2e-5\');20.j(\'.1M-2Q\').8(1X.2Q);20.j(\'.1M-2C\').8(1X.2C);20.j(\'.1M-2s\').8(1X.2s);6(2.1L<=0){1N.1O()}};2.33=3(){1a 4r(3(){2.2F()},2D)};1a 2});',62,314,'||modal|function||container|if|click|html|show||picker|block|list|offic|result|var|data||find|close|icon|tab|core|content|hide|detail|ret|fui|goodsid|else|comments|total||addClass|this|removeClass|attr|salePicker|length|optionid|active|basic|in|cart|giftid|id|alert|true|action|cartcount|count|btn|diyform|params|span|goods|diyformdata|self|new|look|theTime1||infinite|wholesalePicker|FoxUIModal|extraClass|maskClick|danger|on|img|liveid|return|theTime|type|false|col|buyoptions|level|window|item|giftPicker|FoxUI|commentPage|panel|biz|getCommentList|new_temp|60|loaded|json|empty|pickerCode|data_lazy|comment|isfavorite|navbar|attachurl_local|pickerSales|val|getUrl|hideOffic|create|hideComment|order|pickerDown|status|tpl|showImages|lasttime|time|location|reload|theTime2|parseInt|backurl|buy|timer|mustbind|transitionEnd|transition|times|favorite|coupons|obj|src|hideParams|off|class|optionPicker|attachurl_remote|commentCount|stop|text|init|submit|officPage|endtime|seckill|_this|gift|starttime|getOfficList|is|showDetail|getComments|getDetail|selector|cover|hideDetail|load|router|sec|sale|badge|cell|tab3|tab4|siblings|open|tab2|indexOf|min|1000|commentLevel|setSeckillTimer|all|officcode|ajax|url|out|option|css|showOffic|couponpicker|officType|hour|height|swipe|loader|detailHeight|len|remark|pullToLoading|success|loading|cache|JSON|like|setSeckillTimerInterval|sales|fullback|bottom|buttons|city|couponPicker|member|seckillinfo|handlers|coupon|discount|labeltext|normal|good|bad|pagesize|pic|share|replace|onEnd|onStart|officlist|likefill|tabcomment|lazyload|onConfirm|page|getData|Date|autoClose|showConfirm|300|showParams|param|split|add|showComment|default|qrcode|initComment|onLoading|edit|group|download|initSeckill|mask|value|formatSeconds|optiontitle|lazy|first|check|pullToRefresh|done|fold|unfold|child|according|addons|setTimeout|ewei_shopv2|onRefresh|getResponseHeader|get_offic_list|toggle|currenttime|presell|cartbtn|complete|buybtn|map|onRefreshReady|get_comment_list|tab1|tab5|getcount|plugin|define|tpl_goods_detail_comments_list|tabnew|https|for|auto|removeAttr|code|setInterval|http|onerror|unbind|clearInterval|each|prop|checked|giftclick|changeCartcount|eq|typeof|undefined|cantainer|querygift|closest|store|iswholesale|allshop|addwholesale|parse|gifttitle|title|tpl_offic_find_list|onLoadingReady|fadeIn|200|images|isWeixin|gdid|stringify|goods_data_id|ish5app|remove|get_detail|mini|packagePicker|get_comments|tpl_goods_detail_comments'.split('|'),0,{}))
define(['core', 'tpl', 'biz/goods/picker', 'biz/member/favorite', 'biz/member/cart', 'biz/plugin/diyform', 'biz/sale/coupon/couponpicker', 'biz/goods/wholesalePicker'],
function(core, tpl, picker, favorite, cart, diyform, couponpicker, wholesalePicker) {
	var modal = {};
	modal.init = function(params) {
		modal.seckillinfo = params.seckillinfo;
		modal.goodsid = params.goodsid;
		modal.offic = params.offic;
		modal.optionid = 0;
		modal.buyoptions = [];
		modal.total = 1;
		modal.getComments = params.getComments;
		modal.attachurl_local = params.attachurl_local;
		modal.attachurl_remote = params.attachurl_remote;
		modal.coupons = params.coupons;
		modal.new_temp = params.new_temp;
		modal.liveid = params.liveid;
		modal.officType = 0;
		if (modal.offic == "offic") {
			$('#tab .tab.active').removeClass('active');
			$("#offic-tab").addClass("active");
			modal.showOffic()
		}
		if (!modal.new_temp) {
			FoxUI.tab({
				container: $('#tab'),
				handlers: {
					tab1: function() {
						$('.basic-block').show();
						modal.hideDetail();
						modal.hideParams();
						modal.hideComment();
						modal.hideOffic();
						$(".fui-navbar").show();
						$(".look-basic").hide()
					},
					tab2: function() {
						modal.hideParams();
						modal.hideComment();
						modal.hideOffic();
						modal.showDetail();
						$(".fui-navbar").show();
						$(".look-basic").hide()
					},
					tab3: function() {
						modal.showParams();
						modal.hideComment();
						modal.hideOffic();
						$(".fui-navbar").show();
						$(".look-basic").hide()
					},
					tab4: function() {
						modal.showComment();
						modal.hideOffic();
						$(".fui-navbar").show();
						$(".look-basic").hide()
					},
					tab5: function() {
						modal.showOffic()
					}
				}
			})
		} else {
			modal.getDetail();
			FoxUI.tab({
				container: $('#tabnew'),
				handlers: {
					tab2: function() {
						$(".detail-tab-panel .tab-panel[data-tab='tab2']").show().siblings().hide()
					},
					tab3: function() {
						$(".detail-tab-panel .tab-panel[data-tab='tab3']").show().siblings().hide()
					},
					tab4: function() {
						$(".detail-tab-panel .tab-panel[data-tab='tab4']").show().siblings().hide();
						if (!$('.comment-block').attr('loaded')) {
							$('.comment-block').attr('loaded', 1);
							modal.getCommentList()
						}
					}
				}
			})
		}
		$('.coupon-selector').click(function() {
			modal.couponPicker()
		});
		modal.couponPicker = function(action) {
			couponpicker.show({
				coupons: modal.coupons
			})
		};
		modal.hideDetail();
		modal.hideParams();
		modal.hideComment();
		$('.option-selector').click(function() {
			modal.optionPicker('')
		});
		$('#alert-click').on("click",
		function() {
			$("#alert-picker").show();
			$(".alert-content").show()
		});
		$('.alert-close').on("click",
		function() {
			$("#alert-picker").hide()
		});
		$('#alert-mask').on("click",
		function() {
			$("#alert-picker").hide()
		});
		$('#city-picker').click(function() {
			modal.salePicker = new FoxUIModal({
				content: $('#city-picker-modal').html(),
				extraClass: 'picker-modal',
				maskClick: function() {
					modal.salePicker.close()
				}
			});
			modal.salePicker.container.find('.btn-danger').click(function() {
				modal.salePicker.close()
			});
			modal.salePicker.show()
		});
		$('#picker-sales').click(function() {
			modal.pickerSales = new FoxUIModal({
				content: $('#picker-sales-modal').html(),
				extraClass: 'picker-modal',
				maskClick: function() {
					modal.pickerSales.close()
				}
			});
			modal.pickerSales.container.find('.btn-danger').click(function() {
				modal.pickerSales.close()
			});
			modal.pickerSales.show()
		});
		$('#fullback-picker').click(function() {
			modal.salePicker = new FoxUIModal({
				content: $('#fullback-picker-modal').html(),
				extraClass: 'picker-modal',
				maskClick: function() {
					modal.salePicker.close()
				}
			});
			modal.salePicker.container.find('.btn-danger').click(function() {
				modal.salePicker.close()
			});
			modal.salePicker.show()
		});
		$('#sale-picker').click(function() {
			modal.salePicker = new FoxUIModal({
				content: $('#sale-picker-modal').html(),
				extraClass: 'picker-modal',
				maskClick: function() {
					modal.salePicker.close()
				}
			});
			FoxUI.according.init();
			modal.salePicker.container.find('.btn-danger').click(function() {
				modal.salePicker.close()
			});
			modal.salePicker.show()
		});
		$(".bottom-buttons .cartbtn").click(function() {
			var type = $(this).data('type');
			if (type == 4) {
				modal.wholesalePicker('cart')
			} else {
				modal.optionPicker('cart')
			}
		});
		$(".bottom-buttons .buybtn").click(function() {
			var type = $(this).data('type');
			if (type == 4) {
				modal.wholesalePicker('buy')
			} else {
				modal.optionPicker('buy')
			}
		});
		if ($('#time-container').length > 0 || $('#discount-container').length > 0) {
			$('.fui-labeltext').timer({
				onEnd: function() {
					location.reload()
				},
				onStart: function() {
					location.reload()
				}
			})
		} else if ($('#time-presell').length > 0 || $('#discount-container').length > 0) {
			$('.fui-labeltext').timer({
				onEnd: function() {
					location.reload()
				},
				onStart: function() {
					location.reload()
				}
			})
		} else if ($('.seckill-container').length > 0) {
			modal.initSeckill()
		}
		$('.favorite-item').click(function() {
			var self = $(this);
			if (self.attr('submit') == '1') {
				return
			}
			self.attr('submit', 1);
			var isfavorite = self.attr('data-isfavorite') == '1';
			var icon = self.find('.icon');
			icon.addClass('icon-like').removeClass('icon-likefill');
			self.removeClass('active');
			isfavorite = self.attr('data-isfavorite') == '1' ? 0 : 1;
			favorite.toggle(modal.goodsid, isfavorite,
			function(is) {
				self.removeAttr('submit').attr("data-isfavorite", is ? "1": 0);
				if (is) {
					icon.addClass('icon-likefill').removeClass('icon-like');
					self.addClass('active')
				}
			})
		});
		if (core.isWeixin()) {
			$('#btn-share').click(function() {
				$('#cover').fadeIn(200)
			});
			$('#cover').click(function() {
				$('#cover').hide()
			})
		} else {
			$('#btn-share').click(function() {
				if (core.ish5app()) {
					return
				}
				FoxUI.alert("请复制链接发送给好友")
			})
		}
		if (modal.getComments) {
			core.json('goods/detail/get_comments', {
				id: modal.goodsid
			},
			function(ret) {
				var result = ret.result;
				$(".fui-icon-col[data-level='all']").find('.count').html(result.count.all);
				$(".fui-icon-col[data-level='good']").find('.count').html(result.count.good);
				$(".fui-icon-col[data-level='normal']").find('.count').html(result.count.normal);
				$(".fui-icon-col[data-level='bad']").find('.count').html(result.count.bad);
				$(".fui-icon-col[data-level='pic']").find('.count').html(result.count.pic);
				if (ret.status == 1 && result.list.length > 0) {
					modal.initComment();
					if (!modal.new_temp) {
						$('#tabcomment').show();
						core.tpl('#comments-container', 'tpl_goods_detail_comments', ret.result);
						$('#comments-container .fui-cell:first-child').click(function() {
							$("#tabcomment").click()
						})
					}
					$('#comments-container').lazyload()
				};
				core.showImages('#comments-container .remark.img img')
			})
		}
		if (!modal.new_temp) {
			$('.basic-block').pullToLoading({
				onLoadingReady: function() {
					$(".look-detail").html("<i class='icon icon-unfold'></i> <span>释放查看图文详情</span>")
				},
				onLoading: function() {
					$(".look-detail").html("<i class='icon icon-fold'></i> <span>上拉查看图文详情</span>");
					$('.basic-block').pullToLoading('done');
					modal.showDetail();
					$('#tab .tab.active').removeClass('active');
					$('#tab .tab:eq(1)').addClass('active')
				}
			})
		}
		if (typeof(window.cartcount) !== 'undefined') {
			picker.changeCartcount(window.cartcount)
		};
		core.showImages('.goods-swipe .fui-swipe-item img');
		$(".fui-cell-giftclick").click(function() {
			modal.giftPicker = new FoxUIModal({
				content: $('#gift-picker-modal').html(),
				extraClass: 'picker-modal',
				maskClick: function() {
					modal.giftPicker.close()
				}
			});
			modal.giftPicker.container.find('.btn-danger').click(function() {
				modal.giftPicker.close()
			});
			modal.giftPicker.show();
			var giftid = $("#giftid").val();
			$(".gift-item").each(function() {
				if ($(this).val() == giftid) {
					$(this).prop("checked", "true")
				}
			});
			$(".gift-item").on("click",
			function() {
				$.ajax({
					url: core.getUrl('goods/detail/querygift', {
						id: $(this).val()
					}),
					cache: true,
					success: function(data) {
						data = window.JSON.parse(data);
						if (data.status > 0) {
							$("#giftid").val(data.result.id);
							$("#gifttitle").text(data.result.title)
						}
					}
				})
			})
		});
		$(".offic-list-tab a").off("click").on("click",
		function() {
			var _this = $(this);
			modal.officType = _this.attr("data-type");
			$(".offic-list-tab a").removeClass("active");
			_this.addClass("active");
			modal.getOfficList()
		});
		modal.officcode();
		$('.show-allshop-btn').click(function() {
			$(this).closest('.store-container').addClass('open')
		})
	};
	modal.wholesalePicker = function(action) {
		wholesalePicker.open({
			goodsid: modal.goodsid,
			total: modal.total,
			split: ';',
			action: action,
			optionid: '',
			showConfirm: true,
			autoClose: false,
			mustbind: modal.mustbind,
			backurl: modal.backurl,
			onConfirm: function(buyoptions) {
				modal.buyoptions = buyoptions;
				if (action == 'buy') {
					wholesalePicker.close();
					$.router.load(core.getUrl('order/create', {
						id: modal.goodsid,
						iswholesale: 1,
						buyoptions: window.JSON.stringify(modal.buyoptions)
					}), false)
				} else if (action == 'cart') {
					cart.addwholesale(modal.goodsid, modal.buyoptions,
					function(ret) {
						$('.cart-item').find('.badge').html(ret.cartcount).removeClass('out').addClass('in');
						window.cartcount = ret.cartcount
					});
					wholesalePicker.close()
				} else {
					wholesalePicker.close()
				}
			}
		})
	};
	modal.giftPicker = function() {
		modal.giftPicker = new FoxUIModal({
			content: $('#option-picker-modal').html(),
			extraClass: 'picker-modal',
			maskClick: function() {
				modal.packagePicker.close()
			}
		})
	};
	modal.getDetail = function() {
		if ($('.detail-block').find('.content-block').html() != '') {
			return
		}
		FoxUI.loader.show('mini');
		$.ajax({
			url: core.getUrl('goods/detail/get_detail', {
				id: modal.goodsid
			}),
			cache: true,
			success: function(html) {
				FoxUI.loader.hide();
				var detailHeight = $('.detail-block').css('height');
				$('.detail-block').find('.content-block').css('height', detailHeight).html(html);
				setTimeout(function() {
					$('.detail-block').lazyload();
					$('.detail-block').find('.content-block').css('height', 'auto');
					core.showImages('.content-block img');
					var $html = $(html).find('img');
					if ($html.length > 0) {
						for (var i = 0,
						len = $html.length; i < len; i++) {
							$html[i].onerror = function() {
								var $this = $(this);
								var data_lazy = $this.attr('data-lazy');
								if (!$this.attr('check-src') && (data_lazy.indexOf('http://') > -1 || data_lazy.indexOf('https://') > -1)) {
									var src = data_lazy.indexOf(modal.attachurl_local) == -1 ? data_lazy.replace(modal.attachurl_remote, modal.attachurl_local) : data_lazy.replace(modal.attachurl_local, modal.attachurl_remote);
									$this.attr('data-lazy', src);
									$this.attr('check-src', true)
								}
							}
						}
					}
				},
				1000);
				if (!modal.new_temp) {
					$('.detail-block').pullToRefresh({
						onRefreshReady: function() {
							$(".look-basic").html("<i class='icon icon-fold'></i> <span>释放返回商品详情</span>")
						},
						onRefresh: function() {
							$(".look-basic").html("<i class='icon icon-unfold'></i> <span>下拉返回商品详情</span>");
							$('.basic-block').show();
							$('.detail-block').removeClass('in').pullToRefresh('done');
							$('#tab .tab.active').removeClass('active');
							$('#tab .tab:first-child').addClass('active')
						}
					})
				}
			}
		})
	};
	modal.showDetail = function() {
		$('.basic-block').hide();
		modal.getDetail();
		$('.detail-block').transition(300).addClass('in').transitionEnd(function() {
			$('.detail-block').transition('')
		})
	};
	modal.hideDetail = function() {
		$('.basic-block').show();
		$('.detail-block').transition(300).removeClass('in').transitionEnd(function() {
			$('.detail-block').transition('')
		})
	};
	modal.showParams = function() {
		$('.param-block').show().addClass('in')
	};
	modal.hideParams = function() {
		$('.param-block').removeClass('in')
	};
	modal.optionPicker = function(action) {
		picker.open({
			goodsid: modal.goodsid,
			total: modal.total,
			split: ';',
			action: action,
			optionid: modal.optionid,
			showConfirm: true,
			autoClose: false,
			mustbind: modal.mustbind,
			backurl: modal.backurl,
			liveid: modal.liveid,
			onConfirm: function(total, optionid, optiontitle) {
				modal.total = total;
				modal.optionid = optionid;
				$('.option-selector').html("已选: 数量x" + total + " " + optiontitle);
				if (action == 'buy') {
					var giftid = $("#giftid").val();
					if ($("#giftid") && giftid == '') {
						FoxUI.alert("请选择赠品！");
						$(".picker-modal").remove()
					} else {
						if ($('.diyform-container').length > 0) {
							var diyformdata = diyform.getData('.diyform-container');
							if (!diyformdata) {
								return
							} else {
								core.json('order/create/diyform', {
									id: modal.goodsid,
									diyformdata: diyformdata
								},
								function(ret) {
									$.router.load(core.getUrl('order/create', {
										id: modal.goodsid,
										optionid: modal.optionid,
										total: modal.total,
										gdid: ret.result.goods_data_id,
										giftid: giftid,
										liveid: modal.liveid
									}), true)
								},
								true, true);
								picker.close()
							}
						} else {
							picker.close();
							$.router.load(core.getUrl('order/create', {
								id: modal.goodsid,
								optionid: modal.optionid,
								total: modal.total,
								giftid: giftid,
								liveid: modal.liveid
							}), false)
						}
					}
				} else if (action == 'cart') {
					if ($('.diyform-container').length > 0) {
						var diyformdata = diyform.getData('.diyform-container');
						if (!diyformdata) {
							return
						} else {
							core.json('order/create/diyform', {
								id: modal.goodsid,
								diyformdata: diyformdata
							},
							function(ret) {
								cart.add(modal.goodsid, modal.optionid, modal.total, diyformdata,
								function(ret) {
									$('.cart-item').find('.badge').html(ret.cartcount).removeClass('out').addClass('in');
									window.cartcount = ret.cartcount
								})
							},
							true, true);
							picker.close()
						}
					} else {
						cart.add(modal.goodsid, modal.optionid, modal.total, false,
						function(ret) {
							$('.cart-item').find('.badge').html(ret.cartcount).removeClass('out').addClass('in');
							window.cartcount = ret.cartcount
						});
						picker.close()
					}
				} else {
					picker.close()
				}
			}
		})
	};
	modal.showComment = function() {
		$('.comment-block').show().addClass('in').transitionEnd(function() {
			if (!$('.comment-block').attr('loaded')) {
				$('.comment-block').attr('loaded', 1);
				modal.getCommentList()
			}
		})
	};
	modal.showOffic = function() {
		$('.offic-block').show().addClass('in').transitionEnd(function() {
			if (!$('.offic-block').attr('loaded')) {
				$('.offic-block').attr('loaded', 1);
				modal.getOfficList()
			}
		});
		$(".offic-goods-edit").show();
		$(".fui-navbar").hide();
		$(".look-basic").hide()
	};
	modal.hideOffic = function() {
		$('.offic-block').removeClass('in');
		$(".offic-goods-edit").hide()
	};
	modal.hideComment = function() {
		$('.comment-block').removeClass('in')
	};
	modal.initComment = function() {
		modal.commentPage = 1;
		modal.commentLevel = '';
		modal.commentCount = 1;
		$('.fui-content').infinite({
			onLoading: function() {
				modal.getCommentList()
			}
		});
		if (modal.commentPage == 1) {
			modal.getCommentList()
		}
	};
	modal.getCommentList = function() {
		$('#comments-list-container .content-empty').hide();
		$('#comments-list-container .infinite-loading').show();
		core.json('goods/detail/get_comment_list', {
			id: modal.goodsid,
			page: modal.commentPage,
			level: modal.commentLevel,
			getcount: modal.commentCount
		},
		function(ret) {
			var result = ret.result;
			if (result.total <= 0) {
				$('#comments-list-container .container').html('').hide();
				$('#comments-list-container .content-empty').show();
				$('#comments-list-container').infinite('stop')
			} else {
				$('#comments-list-container .container').show();
				$('#comments-list-container .content-empty').hide();
				$('#comments-list-container').infinite('init');
				if (result.list.length <= 0 || result.list.length < result.pagesize) {
					$('#comments-list-container').infinite('stop')
				}
			}
			modal.commentCount = 0;
			modal.commentPage++;
			core.tpl('#comments-list-container .container', 'tpl_goods_detail_comments_list', result, modal.commentPage > 1);
			$('#comments-list-container .fui-icon-group .fui-icon-col').unbind('click').click(function() {
				$('#comments-list-container .fui-icon-group .fui-icon-col span.text-danger').removeClass('text-danger');
				$(this).find('span').addClass('text-danger');
				modal.commentPage = 1;
				modal.commentCount = 1;
				modal.commentLevel = $(this).data('level');
				$('#comments-list-container .container').html('');
				modal.getCommentList()
			});
			core.showImages('#comments-all .remark.img img')
		},
		false)
	};
	modal.getOfficList = function() {
		$('#offic-list-container .content-empty').hide();
		$('#offic-list-container .infinite-loading').show();
		core.json('goods/detail/get_offic_list', {
			id: modal.goodsid,
			page: modal.officPage,
			type: modal.officType
		},
		function(ret) {
			var result = ret.result;
			if (result.total <= 0) {
				$('#offic-list-container .container').html('').hide();
				$('#offic-list-container .content-empty').show();
				$('#offic-list-container').infinite('stop')
			} else {
				$('#offic-list-container .container').show();
				$('#offic-list-container .content-empty').hide();
				$('#offic-list-container').infinite('init');
				if (result.officlist.length <= 0 || result.officlist.length < result.pagesize) {
					$('#offic-list-container').infinite('stop')
				}
			}
			modal.officPage++;
			core.tpl('#offic-list-container .cantainer', 'tpl_offic_find_list', result, modal.officPage > 1);
			core.showImages('.find-list-content-images a img');
			modal.officcode();
			$(".offic-download").off("click").on("click",
			function() {
				modal.pickerDown = new FoxUIModal({
					content: $('#picker-download-modal').html(),
					extraClass: 'picker-modal',
					maskClick: function() {
						modal.pickerDown.close()
					}
				});
				modal.pickerDown.container.find('.btn-default').click(function() {
					modal.pickerDown.close()
				});
				modal.pickerDown.show()
			});
			$('#offic-mask').off("click").on("click",
			function() {
				$("#offic-picker").hide()
			})
		},
		false)
	};
	modal.officcode = function() {
		$('.offic-qrcode').click(function() {
			modal.pickerCode = new FoxUIModal({
				content: $('#picker-qrcode-modal').html(),
				extraClass: 'picker-modal',
				maskClick: function() {
					modal.pickerCode.close()
				}
			});
			modal.pickerCode.container.find('.btn-default').click(function() {
				modal.pickerCode.close()
			});
			modal.pickerCode.show();
			$(".offic-cell-code").off("click").on("click",
			function() {
				modal.pickerCode.close();
				$("#alert-picker").show();
				$(".alert-content").show()
			})
		})
	};
	modal.formatSeconds = function(value) {
		var theTime = parseInt(value);
		var theTime1 = 0;
		var theTime2 = 0;
		if (theTime > 60) {
			theTime1 = parseInt(theTime / 60);
			theTime = parseInt(theTime % 60);
			if (theTime1 > 60) {
				theTime2 = parseInt(theTime1 / 60);
				theTime1 = parseInt(theTime1 % 60)
			}
		}
		return {
			'hour': theTime2 < 10 ? '0' + theTime2: theTime2,
			'min': theTime1 < 10 ? '0' + theTime1: theTime1,
			'sec': theTime < 10 ? '0' + theTime: theTime
		}
	};
	modal.initSeckill = function() {
		var container = $('.seckill-container'),
		starttime = container.data('starttime'),
		endtime = container.data('endtime'),
		status = container.data('status') || 0;
		$.ajax({
			url: '../addons/ewei_shopv2/map.json',
			complete: function(x) {
				currenttime = +new Date(x.getResponseHeader("Date")) / 1000;
				if (status == 0) {
					modal.lasttime = endtime
				} else {
					modal.lasttime = starttime
				}
				clearInterval(modal.timer);
				modal.setSeckillTimer();
				modal.timer = modal.setSeckillTimerInterval()
			}
		})
	};
	modal.setSeckillTimer = function() {
		modal.lasttime -= 1;
		var times = modal.formatSeconds(modal.lasttime);
		var obj = $('.seckill-container');
		obj.find('.time-hour').html(times.hour);
		obj.find('.time-min').html(times.min);
		obj.find('.time-sec').html(times.sec);
		if (modal.lasttime <= 0) {
			location.reload()
		}
	};
	modal.setSeckillTimerInterval = function() {
		return setInterval(function() {
			modal.setSeckillTimer()
		},
		1000)
	};
	return modal
});